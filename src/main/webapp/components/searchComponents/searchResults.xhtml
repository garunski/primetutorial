<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui">

<ui:composition>
    <!-- Results Section -->
    <div class="col-12 col-lg-8">

        <!-- No Results Message -->
        <h:panelGroup layout="block" styleClass="alert alert-warning" rendered="#{empty jobService.filteredJobs}">
            <h5 class="alert-heading">No Results Found</h5>
            <p class="mb-0">Try adjusting your search criteria or browse all jobs.</p>
            <div class="mt-3">
                <h:link outcome="occupationSearchRevised" styleClass="btn btn-outline-primary btn-sm">
                    View All Jobs
                </h:link>
            </div>
        </h:panelGroup>

        <!-- Result Cards -->
        <ui:repeat value="#{jobService.filteredJobs}" var="job">
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h3 class="text-primary fw-semibold fs-4 mb-2">#{job.title}</h3>
                    <div class="text-muted small mb-3">
                        <ui:repeat value="#{searchFilterBean.getCategoryParts(job.category)}" var="categoryPart" varStatus="status">
                            <h:link outcome="occupationSearchRevised" 
                                    styleClass="text-decoration-none text-muted category-link"
                                    value="#{categoryPart}">
                                <f:param name="category" value="#{categoryPart eq null ? '' : categoryPart}" rendered="#{categoryPart ne null and categoryPart ne ''}" />
                            </h:link>
                            <h:outputText value=" | " 
                                          styleClass="text-muted" 
                                          rendered="#{not status.last}" />
                        </ui:repeat>
                    </div>

                    <div class="text-secondary mb-3">
                        <p>#{job.description}</p>
                    </div>

                    <div class="mb-3">
                        <div class="d-inline-block me-4 mb-2">
                            <span class="fw-semibold text-secondary me-2">Average Salary:</span>
                            <span class="text-muted">#{job.salaryRange}</span>
                        </div>
                        <div class="d-inline-block me-4 mb-2">
                            <span class="fw-semibold text-secondary me-2">Preparation:</span>
                            <span class="text-muted">#{job.educationRequired}</span>
                        </div>
                    </div>

                    <div class="mb-3">
                        <ui:repeat value="#{job.skills}" var="skill">
                            <span class="badge bg-light text-secondary me-2 mb-2">#{skill}</span>
                        </ui:repeat>
                    </div>

                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <!-- Job Attributes -->
                            <!-- Bright Outlook: Jobs with good growth/outlook in their title or category -->
                            <h:panelGroup rendered="#{job.title.toLowerCase().contains('engineer') or job.title.toLowerCase().contains('scientist') or job.title.toLowerCase().contains('developer') or job.title.toLowerCase().contains('analyst') or job.title.toLowerCase().contains('manager') or job.category.toLowerCase().contains('technology') or job.category.toLowerCase().contains('healthcare')}">
                                <span class="btn btn-outline-warning bg-warning bg-opacity-10 text-dark rounded-pill px-2 py-1 me-1 mb-1" style="font-size: 0.75rem;">
                                    <i class="bi bi-check-circle-fill text-warning me-1"></i>
                                    Bright Outlook
                                </span>
                            </h:panelGroup>
                            
                            <!-- Green Jobs: Jobs related to environment, sustainability, etc. -->
                            <h:panelGroup rendered="#{job.title.toLowerCase().contains('scientist') or job.category.toLowerCase().contains('agriculture') or job.category.toLowerCase().contains('science') or job.title.toLowerCase().contains('engineer')}">
                                <span class="btn btn-outline-success bg-success bg-opacity-10 text-dark rounded-pill px-2 py-1 me-1 mb-1" style="font-size: 0.75rem;">
                                    <i class="bi bi-check-circle-fill text-success me-1"></i>
                                    Green Job
                                </span>
                            </h:panelGroup>
                            
                            <!-- Apprenticeship: Jobs that typically have apprenticeship programs (moderate training, trades) -->
                            <h:panelGroup >
                                <span class="btn btn-outline-primary bg-primary bg-opacity-10 text-dark rounded-pill px-2 py-1 me-1 mb-1" style="font-size: 0.75rem;">
                                    <i class="bi bi-check-circle-fill text-primary me-1"></i>
                                    Apprenticeship
                                </span>
                            </h:panelGroup>
                        </div>
                        <div>
                            <h:button value="View Details" outcome="careerDetails" styleClass="btn btn-primary btn-sm">
                                <f:param name="jobId" value="#{job.id eq null ? '' : job.id}" rendered="#{job.id ne null}" />
                            </h:button>
                        </div>
                    </div>
                </div>
            </div>
        </ui:repeat>

        <!-- Pagination Component (only show if we have results) -->
        <h:panelGroup layout="block" rendered="#{not empty jobService.filteredJobs}">
            <ui:include src="/components/searchComponents/searchPagination.xhtml" />
        </h:panelGroup>
    </div>
</ui:composition>
</html>
